#!/bin/bash --login

#SBATCH --time=00:20:00
#SBATCH --ntasks=1           
#SBATCH --cpus-per-task=4   
#SBATCH --mem=16G   
#SBATCH --job-name  eestat2
#SBACTH -A shade-cole-bonito

cd ${SLURM_SUBMIT_DIR}
cores="$SLURM_CPUS_PER_TASK"
RAM="$SLURM_MEM_PER_NODE"

echo -e "\n==== Paths, variables, links ====\n"
echo -e "cd /mnt/home/benucci/Amplicon-PacBio/stripped/"
cd /mnt/home/benucci/Amplicon-PacBio/stripped/
echo -e "mkdir /mnt/home/benucci/Amplicon-PacBio/ccslength"
mkdir /mnt/home/benucci/Amplicon-PacBio/ccslength

echo -e "\n========= seqtk, length =========\n"
conda activate seqtk

cat pooled.fastq | paste - - - - | awk 'length($0) >=1299 && length($0) <= 1300' | sed 's/\t/\n/g' > /mnt/home/benucci/Amplicon-PacBio/ccslength/1300.fastq
seqtk sample -s100 /mnt/home/benucci/Amplicon-PacBio/ccslength/1300.fastq 10 > /mnt/home/benucci/Amplicon-PacBio/ccslength/1300_10.fastq
seqtk seq -aQ64 /mnt/home/benucci/Amplicon-PacBio/ccslength/1300_10.fastq > /mnt/home/benucci/Amplicon-PacBio/ccslength/1300_10.fasta

cat pooled.fastq | paste - - - - | awk 'length($0) >=1399 && length($0) <= 1400' | sed 's/\t/\n/g' > /mnt/home/benucci/Amplicon-PacBio/ccslength/1400.fastq
seqtk sample -s100 /mnt/home/benucci/Amplicon-PacBio/ccslength/1400.fastq 10 > /mnt/home/benucci/Amplicon-PacBio/ccslength/1400_10.fastq
seqtk seq -aQ64 /mnt/home/benucci/Amplicon-PacBio/ccslength/1400_10.fastq > /mnt/home/benucci/Amplicon-PacBio/ccslength/1400_10.fasta

cat pooled.fastq | paste - - - - | awk 'length($0) >=1499 && length($0) <= 1500' | sed 's/\t/\n/g' > /mnt/home/benucci/Amplicon-PacBio/ccslength/1500.fastq
seqtk sample -s100 /mnt/home/benucci/Amplicon-PacBio/ccslength/1500.fastq 10 > /mnt/home/benucci/Amplicon-PacBio/ccslength/1500_10.fastq
seqtk seq -aQ64 /mnt/home/benucci/Amplicon-PacBio/ccslength/1500_10.fastq > /mnt/home/benucci/Amplicon-PacBio/ccslength/1500_10.fasta

cat pooled.fastq | paste - - - - | awk 'length($0) >=1599 && length($0) <= 1600' | sed 's/\t/\n/g' > /mnt/home/benucci/Amplicon-PacBio/ccslength/1600.fastq
seqtk sample -s100 /mnt/home/benucci/Amplicon-PacBio/ccslength/1600.fastq 10 > /mnt/home/benucci/Amplicon-PacBio/ccslength/1600_10.fastq
seqtk seq -aQ64 /mnt/home/benucci/Amplicon-PacBio/ccslength/1600_10.fastq > /mnt/home/benucci/Amplicon-PacBio/ccslength/1600_10.fasta

cat pooled.fastq | paste - - - - | awk 'length($0) >=1999 && length($0) <= 2000' | sed 's/\t/\n/g' > /mnt/home/benucci/Amplicon-PacBio/ccslength/2000.fastq
seqtk sample -s100 /mnt/home/benucci/Amplicon-PacBio/ccslength/2000.fastq 10 > /mnt/home/benucci/Amplicon-PacBio/ccslength/2000_10.fastq
seqtk seq -aQ64 /mnt/home/benucci/Amplicon-PacBio/ccslength/2000_10.fastq > /mnt/home/benucci/Amplicon-PacBio/ccslength/2000_10.fasta

cat pooled.fastq | paste - - - - | awk 'length($0) >=2499 && length($0) <= 2500' | sed 's/\t/\n/g' > /mnt/home/benucci/Amplicon-PacBio/ccslength/2500.fastq
seqtk sample -s100 /mnt/home/benucci/Amplicon-PacBio/ccslength/2500.fastq 10 > /mnt/home/benucci/Amplicon-PacBio/ccslength/2500_10.fastq
seqtk seq -aQ64 /mnt/home/benucci/Amplicon-PacBio/ccslength/2500_10.fastq > /mnt/home/benucci/Amplicon-PacBio/ccslength/2500_10.fasta

cat pooled.fastq | paste - - - - | awk 'length($0) >=2999 && length($0) <= 3000' | sed 's/\t/\n/g' > /mnt/home/benucci/Amplicon-PacBio/ccslength/3000.fastq
seqtk sample -s100 /mnt/home/benucci/Amplicon-PacBio/ccslength/3000.fastq 10 > /mnt/home/benucci/Amplicon-PacBio/ccslength/3000_10.fastq
seqtk seq -aQ64 /mnt/home/benucci/Amplicon-PacBio/ccslength/3000_10.fastq > /mnt/home/benucci/Amplicon-PacBio/ccslength/3000_10.fasta

conda deactivate

cd /mnt/home/benucci/Amplicon-PacBio/ccslength/
cat 1300_10.fasta 1400_10.fasta 1500_10.fasta 1600_10.fasta 2000_10.fasta 2500_10.fasta 3000_10.fasta > seq10range.fasta

echo -e "\n====== Sbatch log ========\n"
scontrol show job $SLURM_JOB_ID 

cp /mnt/home/benucci/Amplicon-PacBio/pipeline/slurm* \
/mnt/home/benucci/Amplicon-PacBio/stats/cssLength.slurm
#rm /mnt/home/benucci/Amplicon-PacBio/pipeline/slurm*


